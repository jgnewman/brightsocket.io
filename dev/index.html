<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Brightsocket Test Page</title>
  </head>
  <body>
    Alive!

    <script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">

      function fauxbrightsocketclient(location) {
        function BrightSocketClient(location) {
          this.socket = location ? io(location) : io();
        }
        BrightSocketClient.prototype = {
          identify: function (userType, optionalPayload) {
            var proxyPayload = optionalPayload ? Object.assign({}, optionalPayload) : {};
            proxyPayload["BRIGHTSOCKET_INTERNAL:USERTYPE"] = userType;
            this.socket.emit('BRIGHTSOCKET_INTERNAL:IDENTIFY', proxyPayload);
          },
          receive: function (action, callback) {
            return this.socket.on(action, callback);
          },
          send: function (action, optionalPayload) {
            return optionalPayload ? this.socket.emit(action, optionalPayload) : this.socket.emit(action);
          }
        };
        return new BrightSocketClient(location);
      }

      var socket = fauxbrightsocketclient();

      socket.identify('USER');

      socket.receive('err:UNAUTHORIZED', function (payload) {
        console.log(payload);
        console.log('trying again');
        socket.identify('USER', {
          username: 'fake@fake.com',
          password: 'password'
        });
      });

      socket.receive('ok:IDENTIFIED', function (payload) {
        console.log('successfully identified', payload);
        socket.send('FAVORITE_FOOD');
        socket.send('FAVORITE_MOVIE');
      });

      socket.receive('ok:FAVORITE_FOOD', function (payload) {
        console.log('favorite food is', payload);
      });

      socket.receive('ok:FAVORITE_MOVIE', function (payload) {
        console.log('favorite movie is', payload);
      });

    </script>
  </body>
</html>
